<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-item/paper-item-body.html">
<link rel="import" href="discussions-topic-post-reply-item.html">
<link rel="import" href="../prefetch-mixin.html">
<link rel="import" href="../siren-entity-mixin.html">
<link rel="import" href="../shared-styles.html">

<dom-module id="d2l-discussions-topic-post-reply-list">
    <template>
        <style include="shared-styles">
            :host {
                display: block;
            }
        </style>
        <div class="basic-left-padding">
            <template is="dom-repeat" items="[[replies]]">
                <d2l-discussions-topic-post-reply-item href="{{_getHref(item)}}" token="{{token}}"></d2l-discussions-topic-post-reply-item>
            </template>
        </div>
        <slot></slot>
    </template>

    <script>
        /* @mixes PrefetchMixin
           @mixes SirenEntityMixin */
        class DiscussionsTopicPostReplyList extends PrefetchMixin(SirenEntityMixin(Polymer.Element)) {

            static get interesting() {
                return [
                    {
                        getLinks: entity => entity.entities && entity.entities.map(item => item.getLinkByRel('self')),
                        elements: [window.customElements.get('d2l-discussions-topic-post-reply-item')]
                    }
                ];
            }

            static get is() { return 'd2l-discussions-topic-post-reply-list'; }

            static get properties() {
                return {
                    post: {
                        type: Object,
                        value: {}
                    },
                    replies: {
                        type: Array,
                        value: []
                    },
                    token: String,
                    href: String
                };
            }

            static get observers() {
                return [
                    '_changed(entity)'
                ];
            }

            _changed(entity) {
                this.post = entity;
                this.replies = this.post.entities;
            }

            _getHref(item) {
                return item.getLinkByRel('self') && item.getLinkByRel('self').href;
            }

        }

        window.customElements.define(DiscussionsTopicPostReplyList.is, DiscussionsTopicPostReplyList);
    </script>
</dom-module>
