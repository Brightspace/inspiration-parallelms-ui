<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../siren-entity-mixin.html">
<link rel="import" href="update-item.html">

<dom-module id="d2l-updates-card">
	<template>
		<style>
			:host {
				display: inline-block;
			}
			.header {
				background:#37A0CE;
				color:white;
			}
			paper-card {
				height: 650px;
				overflow-y: scroll;
				width: 500px;
			}
			h2 {
    			font-weight: normal;
    			margin: 0;
				padding: 10px;
			}
		</style>

		<paper-card>
			<div class="header">
				<h2>New Updates</h2>
				<paper-tabs selected="{{selected}}" scrollable --paper-tabs-selection-bar-color: white>
					<paper-tab>News</paper-tab>
					<paper-tab>Grades</paper-tab>
				</paper-tabs>
			</div>
			<iron-pages selected="{{selected}}">
				<div>
					<template is="dom-repeat" items="[[newsUpdates]]" strip-whitespace>
						<d2l-update-item href="[[_getSelfLink(item)]]" token="{{token}}"></d2l-update-item>
					</template>
				</div>
				<div>
					<template is="dom-repeat" items="[[gradeUpdates]]" strip-whitespace>
						<d2l-update-item href="[[_getSelfLink(item)]]" token="{{token}}"></d2l-update-item>
					</template>
				</div>
			</iron-pages>
		</paper-card>
	</template>

	<script>
		/* @mixes SirenEntityMixin */
		class UpdatesCard extends SirenEntityMixin(Polymer.Element) {
			static get is() { return 'd2l-updates-card'; }

			static get properties() {
				return {
					selected: {
						type: Number,
						value: 0
					},
					newsUpdates: {
						type: Array,
						value: []
					},
					gradeUpdates: {
						type: Array,
						value: []
					},
					token: String
				};
			}

			static get observers() {
				return [
					'_changed(entity)'
				];
			}

			_changed(entity) {
				this.newsUpdates = entity.getSubEntitiesByClass('news');
				this.gradeUpdates = entity.getSubEntitiesByClass('grade');
			}

			_getSelfLink(entity) {
				return entity.getLinkByRel('self').href;
			}
		}

		window.customElements.define(UpdatesCard.is, UpdatesCard);
	</script>
</dom-module>
