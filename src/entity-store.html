<script>
(function() {
	'use strict';

	/*
		This store is hacked together to develop entity-mixin.
	*/
	var EntityStore = {

		_store: {
			'course.1': { 'name': 'Chemical Hydrogeology' },
			'course.2': { 'name': 'Plant Physiology' },
			'https://f1bbe417-8c9c-48c0-90b2-75c0cfaceda5.users.api.proddev.d2l/175': {
				'class':[
					'user'
				],
				'entities':[
					{
						'class':[
							'display',
							'name'
						],
						'properties':{
							'name':'Fname user'
						},
						'rel':[
							'https://api.brightspace.com/rels/display-name'
						]
					},
					{
						'class':[
							'first',
							'name'
						],
						'properties':{
							'name':'Fname'
						},
						'rel':[
							'https://api.brightspace.com/rels/first-name'
						]
					},
					{
						'class':[
							'profile'
						],
						'entities':[
							{
								'class':[
									'file',
									'image',
									'default-image'
								],
								'properties':{
									'smallRelativePath':'/d2l/img/0/Framework.UserProfileBadge.actProfile22.png?v=10.7.6.0-0809452',
									'regularRelativePath':'/d2l/img/0/Framework.UserProfileBadge.actProfile50.png?v=10.7.6.0-0809452'
								},
								'links':[
									{
										'rel':[
											'alternate'
										],
										'href':'http://KLX1-EKNUTSON:44453/d2l/img/0/Framework.UserProfileBadge.actProfile200.png?v=10.7.6.0-0809452'
									},
									{
										'rel':[
											'preview',
											'https://api.brightspace.com/rels/thumbnail#small'
										],
										'href':'http://KLX1-EKNUTSON:44453/d2l/img/0/Framework.UserProfileBadge.actProfile22.png?v=10.7.6.0-0809452'
									},
									{
										'rel':[
											'preview',
											'https://api.brightspace.com/rels/thumbnail#regular'
										],
										'href':'http://KLX1-EKNUTSON:44453/d2l/img/0/Framework.UserProfileBadge.actProfile50.png?v=10.7.6.0-0809452'
									}
								],
								'rel':[
									'https://api.brightspace.com/rels/profile-image'
								]
							}
						],
						'rel':[
							'https://api.brightspace.com/rels/user-profile'
						]
					}
				],
				'links':[
					{
						'rel':[
							'https://activities.api.brightspace.com/rels/my-activities'
						],
						'href':'https://f1bbe417-8c9c-48c0-90b2-75c0cfaceda5.activities.api.proddev.d2l/users/175?start=2017-09-11T14%3a46%3a09.630Z&end=2017-09-18T14%3a46%3a09.630Z'
					},
					{
						'rel':[
							'https://discussions.api.brightspace.com/rels/my-subscriptions'
						],
						'href':'https://f1bbe417-8c9c-48c0-90b2-75c0cfaceda5.discussions.api.proddev.d2l/subscriptions/threads/users/175'
					},
					{
						'rel':[
							'self'
						],
						'href':'https://f1bbe417-8c9c-48c0-90b2-75c0cfaceda5.users.api.proddev.d2l/175'
					},
					{
						'rel':[
							'https://api.brightspace.com/rels/root'
						],
						'href':'http://KLX1-EKNUTSON:44453/d2l/api/hm'
					},
					{
						'rel':[
							'https://api.brightspace.com/rels/my-enrollments'
						],
						'href':'https://f1bbe417-8c9c-48c0-90b2-75c0cfaceda5.enrollments.api.proddev.d2l/users/175'
					},
					{
						'rel':[
							'https://parentportal.api.brightspace.com/rels/parent'
						],
						'href':'https://f1bbe417-8c9c-48c0-90b2-75c0cfaceda5.users.api.proddev.d2l/12'
					}
				]
			}
		},

		_listeners: {},

		addListener: function(entityId, listener) {

			if (!entityId || typeof listener !== 'function') {
				return;
			}

			var listeners = this._listeners[entityId];
			if (listeners) {
				if (listeners.indexOf(listener) !== -1) {
					return;
				}
			} else {
				this._listeners[entityId] = listeners = [];
			}

			listeners.push(listener);

		},

		fetch: function(entityId) {
			return new Promise((resolve) => {

				// fake it
				var entity = this._store[entityId];

				var listeners = this._listeners[entityId];
				if (listeners) {
					for (var i = 0; i < listeners.length; i++) {
						listeners[i](entity);
					}
				}

				resolve(entity);

			});
		},

		update: function(entityId, entity) {
			return new Promise((resolve) => {

				// fake it
				this._store[entityId] = entity;

				var listeners = this._listeners[entityId];
				if (listeners) {
					for (var i = 0; i < listeners.length; i++) {
						listeners[i](entity);
					}
				}

				resolve(entity);

			});
		},

		removeListener: function(entityId, listener) {

			if (!entityId || typeof listener !== 'function') {
				return;
			}

			var listeners = this._listeners[entityId];
			var index = listeners.indexOf(listener);
			if (index === -1) {
				return;
			}

			// maybe just set null and clean up array in requestIdleCallback
			listeners.splice(index, 1);

		}

	};

	window.D2L = window.D2L || {};
	window.D2L.EntityStore = EntityStore;

})();
</script>
