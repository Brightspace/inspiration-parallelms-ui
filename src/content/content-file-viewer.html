<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../siren-entity-mixin.html">
<link rel="import" href="../../bower_components/d2l-image/d2l-image.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../shared-styles.html">


<dom-module id="d2l-content-file-viewer">
	<template>
		<style include="shared-styles">
			:host {
				display: block;
			}
			.image {
				width: 50px;
				height: 50px;
			}
			.center {
				align-self: center;
			}
			.content-iframe {
				width: 100%;
				height: 500px;
				border: none;
			}
		</style>
		<div>
			<template is="dom-if" if="[[isHtml]]">
				<iframe src="[[link]]" class="content-iframe"></iframe>
			</template>
			<template is"dom-if" if="[[isImage]]">
				<d2l-image image-url=="[[link]]" token="{{token}}" ></d2l-image>
			</template>
		</div>
	</template>

	<script>
		/* @mixes SirenEntityMixin */
		class ContentFileViewer extends SirenEntityMixin(Polymer.Element) {
			static get is() { return 'd2l-content-file-viewer'; }

			static properties() {
				return {
					title: '',
					link: '',
					type: '',
					isHtml: false,
					isImage: false
				};
			}

			static get observers() {
				return [
					'_changed(entity, token)'
				];
			}
			_changed(entity) {
				const _this = this;
				const fileActivity = entity.getSubEntityByClass('file-activity');
				if (fileActivity) {
					const file = fileActivity.getSubEntityByClass('file');
					const _link = file.getLinkByRel('alternate');
					_this.title = entity.properties.title;
					_this.type = _link.type;
					switch (_link.type) {
						case 'text/html': {
							_this.link = _link.href;
							_this.isHtml = true;
							break;
						}
						case 'image/jpg':
						case 'image/jpeg':
						case 'image/png':
						case 'image/gif':
						case 'image/tif': {
							_this.link = _link.href;
							_this.isImage = true;
							break;
						}
					}
					return;
				}

				const linkActivity = entity.getSubEntityByClass('link-activity');
				if (linkActivity) {
					const _link = linkActivity.getLinkByRel('about');
					_this.title = entity.properties.title;
					_this.link = _link.href;
					_this.isHtml = true;
					return;
				}
			}
		}

		window.customElements.define(ContentFileViewer.is, ContentFileViewer);
	</script>
</dom-module>
